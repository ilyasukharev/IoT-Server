## Документация к маршрутам по вебсокетам

### Название маршрута: **Установление соединения с микроконтроллером**

### Маршрут: **/connection/app*

**Алгоритм работы сокета:**

1. *connect* (установление соединения)

             Может вернуть: *command is unknown* (В случае если команда неизвестна)
             Ожидаемый результат: *Sending board id accepted*

2. **Отправление json данных в формате**

   {
       "boardIdentificationData" : 
       {
           "boardUUID": "x"
       }
   }

             x -  в данном случае - вводимое клиентом айди микроконтроллера для подключения

             Может вернуть: *Serialization failed* (Неправильное тело запроса)
             Ожидаемый результат: *Board id successfully received*


3. **Ожидание возврата сообщения**
    
             Может вернуть: *Clients was not connected* (Микроконтроллер не найден)
             Ожидаемый результат: *Board was found*

### Название маршрута: **Аутентификация подключаемого устройства**
### Маршрут: **/management/app/updates**

1. *connect* (Установление соединения)

             Может вернуть: *command is unknown* (В случае если команда неизвестна)
             Ожидаемый результат: *0* (ping)

2. *update* (запрос на обновление)

             Ожидаемый результат: *Submitting request receive*
             Может вернуть (чаще всего): *Update is null*

3. *submit* (подтверждение элемента)

            Ожидаемый результат: *Device was submitted*

4. *decline* (отклоняем элемент)

            Ожидаемый результат: *Device was declined*

## Коды ошибок

### **Authorization exceptions**
[*Неполадки в авторизации*]

| Код ошибки |                 Обстоятельства                 |
|:----------:|:----------------------------------------------:|
|    EA01    |           Код подтверждения неверный           |
|    EA02    |        Время подключения было истрачено        |
|    EA03    |          Пользователь уже существует           |
|    EA04    | Клиент не прошел аутентификацию по вериф. коду |
|    EA05    |   Введённый пароль к учетной записи неверный   |


### **Exposed exceptions**
[*Неполадки при работе с БД*]

| Код ошибки |                Обстоятельства                |
|:----------:|:--------------------------------------------:|
|    EE01    |        Устройство не было обнаружено         |
|    EE02    |      Датчик устройства не был обнаружен      |
|    EE03    |            Пользователь не найден            |
|    EE04    | Пользователь или устройство не было найдено  |
|    EE05    | Идентификатор устройства уже существует в БД |
|    EE06    |    Состояние устройства не было обновлено    |
|    EE07    |  Идентификатор устройства не обнаружен в БД  |
|    EE08    |       Владелец платы не обнаружен в БД       |


### **Token exceptions**
[*Неполадки в организации \ структуре JWT*]

| Код ошибки |                         Обстоятельства                          |
|:----------:|:---------------------------------------------------------------:|
|    ET01    | Время жизни токена было истрачено или его структура некорректна |
|    ET02    |           В Payload JWT отсутствует айди пользователя           |
|    ET03    |              В Payload JWT отсутствует тип токена               |


### **Mail deliver exceptions**
[*Неполадки в отправлении почтовых писем*]

| Код ошибки |                Обстоятельства                 |
|:----------:|:---------------------------------------------:|
|   EMD01    | Данное почтовое сообщение уже было отправлено |
|   EMD02    |     Ошибка в отправлении почтового письма     |


### **Other exceptions**
[*Сторонние ошибки*]

| Код ошибки |                              Обстоятельства                               |
|:----------:|:-------------------------------------------------------------------------:|
|    EO01    |           Устройство не прослушивается сокетом в текущий момент           |
|    EO02    | Переданное состояние устройства для изменения не соответствует стандартам |


### **Socket exceptions**
[*Ошибки на сокете*]

| Порядковый номер |                Название                 |                       Обстоятельство                        |
|:----------------:|:---------------------------------------:|:-----------------------------------------------------------:|
|        1         |           Command is unknown            |                     Неизвестная команда                     |
|        2         |      Such board already listening       |      Это устройство уже ожидает соединения с клиентом       |
|        3         |        Clients was not connected        |                    Клиент не был найден                     |
|        4         | Board is not verified or user not found | Плата не была верифицирована или пользователь не был найден |
|        5         | Such device already registered by user  |        Устройство уже зарегистрировано пользователем        |
|        6         |         Socket timeout response         |        Превышения времени ожидания ответа от сокета         |
|        7         |         Such board is listening         |                  Плата уже прослушивается                   |
|        8         |            boardWasNotSubmit            |             Плата не была подтверждена клиентом             |
|        9         |          deviceStructureError           |     Не найдено ни одного датчика указанного устройства      |